<div class="dashboard-container">
  <header class="header">
    <h1>ğŸ“Š Dashboard</h1>
    <p class="subtitle">{{ nombreNegocio }}</p>
  </header>

  @if (resumen$ | async; as resumen) {
  <!-- KPIs principales -->
  <div class="kpis-grid">
    <div class="kpi-card efectivo">
      <span class="kpi-icon">ğŸ’µ</span>
      <span class="kpi-label">Efectivo Hoy</span>
      <span class="kpi-valor">{{ formatearMoneda(resumen.efectivoHoy) }}</span>
    </div>

    <div class="kpi-card utilidad">
      <span class="kpi-icon">ğŸ“ˆ</span>
      <span class="kpi-label">Utilidad Hoy</span>
      <span class="kpi-valor" [class.negativo]="resumen.utilidadHoy < 0">
        {{ formatearMoneda(resumen.utilidadHoy) }}
      </span>
    </div>

    <div class="kpi-card inventario">
      <span class="kpi-icon">ğŸ“¦</span>
      <span class="kpi-label">Valor Inventario</span>
      <span class="kpi-valor">{{
        formatearMoneda(resumen.valorInventario)
      }}</span>
      <span class="kpi-detalle">{{ resumen.totalBolsas }} bolsas</span>
    </div>

    <div class="kpi-card calle">
      <span class="kpi-icon">ğŸƒ</span>
      <span class="kpi-label">En la Calle</span>
      <span class="kpi-valor">{{
        formatearMoneda(resumen.dineroEnCalle)
      }}</span>
      <span class="kpi-detalle">{{ resumen.clientesConDeuda }} clientes</span>
    </div>
  </div>

  <!-- Rendimiento -->
  <section class="seccion rendimiento-seccion">
    <h2>âš¡ Rendimiento de ProducciÃ³n</h2>
    <div class="rendimiento-contenido">
      <div class="rendimiento-principal">
        <span class="numero">{{ resumen.rendimientoPromedio || "â€”" }}</span>
        <span class="texto">bolsas promedio por kilo</span>
      </div>
      @if (lotes$ | async; as lotes) { @if (lotes.length > 0) {
      <div class="rendimiento-stats">
        <div class="stat">
          <span class="label">Mejor</span>
          <span class="valor mejor">{{ getBestRendimiento(lotes) }}</span>
        </div>
        <div class="stat">
          <span class="label">Peor</span>
          <span class="valor peor">{{ getWorstRendimiento(lotes) }}</span>
        </div>
        <div class="stat">
          <span class="label">Lotes</span>
          <span class="valor">{{ lotes.length }}</span>
        </div>
      </div>
      } }
    </div>
  </section>

  <!-- Desglose del dÃ­a -->
  <section class="seccion">
    <h2>ğŸ“‹ Desglose del DÃ­a</h2>
    <div class="desglose-lista">
      <div class="desglose-item">
        <span class="label">Ventas efectivo:</span>
        <span class="valor positivo">{{
          formatearMoneda(resumen.ventasEfectivoHoy)
        }}</span>
      </div>
      <div class="desglose-item">
        <span class="label">Abonos recibidos:</span>
        <span class="valor positivo">{{
          formatearMoneda(resumen.abonosHoy)
        }}</span>
      </div>
      <div class="desglose-item">
        <span class="label">Ventas fiadas:</span>
        <span class="valor fiado">{{
          formatearMoneda(resumen.ventasFiadoHoy)
        }}</span>
      </div>
      <div class="desglose-item separador">
        <span class="label">Costo de lo vendido:</span>
        <span class="valor negativo"
          >-{{ formatearMoneda(resumen.costoVendidoHoy) }}</span
        >
      </div>
    </div>
  </section>

  <!-- Resumen financiero -->
  <section class="seccion resumen-financiero">
    <h2>ğŸ’° Resumen Financiero</h2>
    <div class="financiero-grid">
      <div class="financiero-item">
        <span class="label">Capital en inventario</span>
        <span class="valor">{{
          formatearMoneda(resumen.valorInventario)
        }}</span>
      </div>
      <div class="financiero-item">
        <span class="label">Capital en calle (fiados)</span>
        <span class="valor">{{ formatearMoneda(resumen.dineroEnCalle) }}</span>
      </div>
      <div class="financiero-item total">
        <span class="label">Capital total trabajando</span>
        <span class="valor">{{
          formatearMoneda(resumen.valorInventario + resumen.dineroEnCalle)
        }}</span>
      </div>
    </div>
  </section>
  } @else {
  <!-- SKELETON LOADING -->
  <div class="cards-grid">
    <!-- Skeleton Ventas -->
    <div
      class="stat-card"
      style="background: #2d2d44; border-left: 4px solid #3d3d5c"
    >
      <app-skeleton
        width="40%"
        height="14px"
        style="margin-bottom: 8px"
      ></app-skeleton>
      <app-skeleton
        width="70%"
        height="32px"
        style="margin-bottom: 4px"
      ></app-skeleton>
      <app-skeleton width="50%" height="12px"></app-skeleton>
    </div>

    <!-- Skeleton Abonos -->
    <div
      class="stat-card"
      style="background: #2d2d44; border-left: 4px solid #3d3d5c"
    >
      <app-skeleton
        width="40%"
        height="14px"
        style="margin-bottom: 8px"
      ></app-skeleton>
      <app-skeleton
        width="70%"
        height="32px"
        style="margin-bottom: 4px"
      ></app-skeleton>
      <app-skeleton width="50%" height="12px"></app-skeleton>
    </div>

    <!-- Skeleton Fiado -->
    <div
      class="stat-card"
      style="background: #2d2d44; border-left: 4px solid #3d3d5c"
    >
      <app-skeleton
        width="40%"
        height="14px"
        style="margin-bottom: 8px"
      ></app-skeleton>
      <app-skeleton
        width="70%"
        height="32px"
        style="margin-bottom: 4px"
      ></app-skeleton>
      <app-skeleton width="50%" height="12px"></app-skeleton>
    </div>

    <!-- Skeleton Total -->
    <div
      class="stat-card"
      style="background: #2d2d44; border-left: 4px solid #3d3d5c"
    >
      <app-skeleton
        width="30%"
        height="14px"
        style="margin-bottom: 8px"
      ></app-skeleton>
      <app-skeleton
        width="80%"
        height="40px"
        style="margin-bottom: 4px"
      ></app-skeleton>
      <app-skeleton width="40%" height="12px"></app-skeleton>
    </div>
  </div>
  }
  <div class="acciones-rapidas" style="margin-top: 24px">
    <button
      class="btn-corte"
      routerLink="/corte-caja"
      style="
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, #6366f1, #4f46e5);
        border: none;
        border-radius: 12px;
        color: white;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
        transition: transform 0.2s;
      "
    >
      <span>âœ‚ï¸</span> Realizar Corte de Caja
    </button>
  </div>
</div>
